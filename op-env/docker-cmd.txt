docker network create op_net

host.docker.internal
--------------------------------------------------

mysql
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname mysql `
    --name mysql `
    -p 3306:3306 `
    -e MYSQL_ROOT_PASSWORD=root `
    mysql
--------------------------------------------------

redis
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname redis `
    --name redis `
    -p 6379:6379 `
    redis
--------------------------------------------------

rabbitmq
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname rabbitmq `
    --name rabbitmq `
    -p 5672:5672 -p 15672:15672 -p 15692:15692 `
    rabbitmq:3-management

https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases
docker cp .\rabbitmq_delayed_message_exchange-3.8.17.8f537ac.ez rabbitmq:/plugins

https://github.com/rabbitmq/rabbitmq-prometheus

docker exec -it rabbitmq bash
rabbitmq-plugins list
rabbitmq-plugins enable rabbitmq_delayed_message_exchange
rabbitmq-plugins enable rabbitmq_prometheus
--------------------------------------------------

elasticsearch
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname elasticsearch `
    --name elasticsearch `
    -p 9200:9200 -p 9300:9300 `
    -e "discovery.type=single-node" `
    elasticsearch:7.13.2
--------------------------------------------------

prometheus
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname prometheus `
    --name prometheus `
    -p 9090:9090 `
    -v /d/Workspace/IdeaProjects/onepiece/op-alliance/op-env:/etc/prometheus `
    prom/prometheus `
    --config.file=/etc/prometheus/prometheus.yml
--------------------------------------------------

grafana
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname grafana `
    --name grafana `
    -p 3000:3000 `
    grafana/grafana
--------------------------------------------------

mysqld-exporter
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname mysqld-exporter `
    --name mysqld-exporter `
    -p 9104:9104 `
    -e DATA_SOURCE_NAME="root:root@(mysql:3306)/" `
    prom/mysqld-exporter
--------------------------------------------------

redis_exporter
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname redis_exporter `
    --name redis_exporter `
    -p 9121:9121 `
    oliver006/redis_exporter `
    --redis.addr redis://redis:6379
--------------------------------------------------

nacos
--------------------------------------------------
https://github.com/alibaba/nacos/blob/master/config/src/main/resources/META-INF/nacos-db.sql

docker run -d `
    --network op_net `
    --hostname nacos `
    --name nacos `
    -p 8848:8848 -p 9848:9848 -p 9555:9555 `
    -v /d/Workspace/IdeaProjects/onepiece/op-alliance/nacos-logs/:/home/nacos/logs `
    -v /d/Workspace/IdeaProjects/onepiece/op-alliance/op-env/nacos.properties:/home/nacos/init.d/custom.properties `
    -e PREFER_HOST_MODE=hostname `
    -e MODE=standalone `
    -e SPRING_DATASOURCE_PLATFORM=mysql `
    -e MYSQL_SERVICE_HOST=mysql `
    -e MYSQL_SERVICE_PORT=3306 `
    -e MYSQL_SERVICE_DB_NAME=nacos `
    -e MYSQL_SERVICE_USER=root `
    -e MYSQL_SERVICE_PASSWORD=root `
    -e MYSQL_SERVICE_DB_PARAM=characterEncoding=utf8"&"connectTimeout=1000"&"socketTimeout=3000"&"autoReconnect=true"&"useSSL=false `
    nacos/nacos-server
--------------------------------------------------

skywalking
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname skywalking-oap `
    --name skywalking-oap `
    -p 11800:11800 -p 12800:12800 `
    -e SW_STORAGE=elasticsearch7 `
    -e SW_STORAGE_ES_CLUSTER_NODES=elasticsearch:9200 `
    apache/skywalking-oap-server:8.6.0-es7

docker run -d `
    --network op_net `
    --hostname skywalking-ui `
    --name skywalking-ui `
    -p 7070:8080 `
    -e SW_OAP_ADDRESS=skywalking-oap:12800 `
    apache/skywalking-ui

http://skywalking.apache.org/downloads/

IDEA:
-javaagent:D:\Workspace\IdeaProjects\onepiece\apache-skywalking-apm-bin-es7\agent\skywalking-agent.jar
-Dskywalking.agent.service_name=op-admin
-Dskywalking.agent.collector.backend_service=127.0.0.1:11800

Docker:
docker build -t onepiece/op-admin .
docker run -d `
    --network op_net `
    --hostname op-admin `
    --name op-admin `
    -p 8082:8082 `
    -e "SPRING_PROFILES_ACTIVE=dev" `
    -t onepiece/op-admin
--------------------------------------------------

loki
--------------------------------------------------
https://grafana.com/docs/loki/latest/installation/docker/

docker run -d `
    --network op_net `
    --hostname loki `
    --name loki `
    -p 3100:3100 `
    -v /d/Workspace/IdeaProjects/onepiece/op-alliance/op-env:/mnt/config `
    grafana/loki `
    --config.file=/mnt/config/loki-config.yaml

docker run -d `
    --network op_net `
    --hostname promtail `
    --name promtail `
    -v /d/Workspace/IdeaProjects/onepiece/op-alliance/op-env:/mnt/config `
    -v /d/Workspace/IdeaProjects/onepiece/op-alliance/loki-logs:/var/log `
    grafana/promtail `
    --config.file=/mnt/config/promtail-config.yaml
--------------------------------------------------

graylog
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname graylog `
    --name graylog `
    -p 9000:9000 `
    -p 15140:1514 `
    -p 15140:1514/udp `
    -p 12201:12201 `
    -p 12201:12201/udp `
    -e GRAYLOG_HTTP_EXTERNAL_URI=http://host.docker.internal:9000/ `
    -e GRAYLOG_ELASTICSEARCH_HOSTS=http://elasticsearch:9200 `
    -e GRAYLOG_MONGODB_URI=mongodb://mongo:27017/graylog `
    -e GRAYLOG_ROOT_TIMEZONE=Asia/Shanghai `
    graylog/graylog:4.1
--------------------------------------------------

mongo
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname mongo `
    --name mongo `
    -p 7071:8081 `
    mongo
--------------------------------------------------

xxl-job-admin
--------------------------------------------------
docker run -d `
    --network op_net `
    --hostname xxl-job-admin `
    --name xxl-job-admin `
    -p 8090:8080 `
    -v /d/Workspace/IdeaProjects/onepiece/op-alliance/xxl-job-logs/:/data/applogs `
    -e PARAMS="--spring.datasource.url=jdbc:mysql://host.docker.internal:3306/xxl_job?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&serverTimezone=Asia/Shanghai
    --spring.datasource.username=root `
    --spring.datasource.password=root `
    --spring.mail.host=smtp.qq.com `
    --spring.mail.port=25 `
    --spring.mail.username=373652466@qq.com `
    --spring.mail.password=cdr_3924 `
    --spring.mail.properties.mail.smtp.auth=true `
    --spring.mail.properties.mail.smtp.starttls.enable=true `
    --spring.mail.properties.mail.smtp.starttls.required=true `
    --spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory" `
    xuxueli/xxl-job-admin:2.3.0
--------------------------------------------------